{
  "name": "codex-isolated",
  "build": {
    "dockerfile": "Dockerfile"
  },

  "workspaceFolder": "/workspaces/project",

  // Only mount the repo. No extra host mounts.
  "workspaceMount": "source=${localWorkspaceFolder},target=/workspaces/project,type=bind,consistency=cached",

  // Don't mount your host HOME, SSH keys, or gitconfig automatically.
  "mounts": [],

  // Further hardening
  "runArgs": [
    "--init",
    "--cap-drop=ALL",
    "--security-opt=no-new-privileges",
    "--pids-limit=512",
    "--memory=4g",

    // Optional but good isolation: no access to host network.
    // Comment this out if Codex can't reach OpenAI from your setup.
    // "--network=none"
    
    // Ensure container can't see host devices.
    "--device-cgroup-rule=c 1:3 rwm"
  ],

  // Keep Codex state inside the container (not your host)
  "remoteUser": "node",
  "containerEnv": {
    "CODEX_HOME": "/home/node/.codex",
    "XDG_CONFIG_HOME": "/home/node/.config",
    "XDG_DATA_HOME": "/home/node/.local/share"
  },
  "postCreateCommand": "mkdir -p /home/node/.codex /home/node/.config /home/node/.local/share",
  "features": {
    "ghcr.io/devcontainers/features/go:1": {}
  }

}
